app = "data-ghost-api"
primary_region = "ord"

[build]
  dockerfile = "Dockerfile"

[env]
  APP_ENV = "prod"
  APP_HOST = "0.0.0.0"
  APP_PORT = "8080"

  # Persist SQLite dataset + metadata on Fly volume.
  DATA_DIR = "/data"
  DOCS_DIR = "/data/docs"
  DB_PATH = "/data/data_ghost.db"

  # LLM routing defaults (safe/cheap baseline).
  LLM_PROVIDER = "openai"
  LLM_DEFAULT_MODEL = "gpt-4o-mini"
  LLM_CHEAP_MODEL = "gpt-4o-mini"
  LLM_EXPENSIVE_MODEL = "gpt-4.1"

  # Safety/cost knobs.
  QUERY_TIMEOUT_SECONDS = "5.0"
  QUERY_MAX_ROWS = "5000"
  QUERY_MAX_PER_REQUEST = "10"

[http_service]
  internal_port = 8080
  force_https = true
  auto_stop_machines = "stop"
  auto_start_machines = true
  min_machines_running = 1
  processes = ["app"]

[[mounts]]
  source = "data_ghost_data"
  destination = "/data"
